<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="style.css">
<script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
<script src="base.js"></script>
<script src="game.js"></script>
<script src="game.rules.js"></script>
<script src="game.map.js"></script>
<script src="game.player.js"></script>
<script src="views.js"></script>
<script src="views.html.js"></script>
<script src="views.map.js"></script>
<script src="views.map.hover.js"></script>
<script src="views.map.linehover.js"></script>
<script src="views.map.cornerhover.js"></script>
<script src="views.description.js"></script>
<script>

$(function(){
	Views.setElements({main_elem: '.game'});

	var game = new Game({
		views: Views,
		validation: true
	});

	// Prompt

	$(document).on('click', '.prompt [type="submit"]', function(e){
		var elem = $(this).closest('form');

		if (elem.find('[type="text"]').val()){
			e.preventDefault();// prevent form sending
			Views.Trigger('enter_string', elem.parent().parent());
		}
	});
	$(document).on('click', '.prompt .cancel, .prompt .overlay', function(){
		if ($(this).data('cancel')){
			Views.hideModalMessage('.prompt');
		}
	});
	$(document).on('enter_string', '.prompt', function(){
		var elem = $(this);
		var validator = elem.data('validator');
		var input = elem.find('input');
		var v = input.val();

		// if validator named and exists
		if (validator && !game[validator](v)){
			input.val('');
			return;
		}

		Views.hideModalMessage(this);
		game[elem.data('action')](v);
	});

	// Game Process

	$(document).on('click', '.start_btn', function(){
		if (!Views.isDisabled(this)){
			game.EnterPlayersCount('NewGame', true);// with Cancel button
		}
	});
	$(document).on('click', '.step_btn', function(){
		if (!Views.isDisabled(this)){
			Views.Trigger('next_step');
		}
	});
	$(document).on('next_step', function(){
		game.Step();
	});

	// Interaction

	$(document).on('click', '.description .receipt', function(){
		game.setCurrentObjectType( Views.isDisabled(this) ? null : Views.toggleHoverTable(this, game.getCurrentObjectType()) );
	});
	$(document).on('click', '.map .corner, .map .line', function(){
		if (game.getCurrentObjectType() && !Views.map.ObjectIsSet(this))
		{
			Views.map.setObject(this);
			game.setObject();
		}
	});
});
</script>
</head>

<body>
	<div class="game"></div>
</body>
</html>
