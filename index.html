<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="style.css">
<script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
<script src="base.js"></script>
<script src="game.js"></script>
<script src="game.rules.js"></script>
<script src="game.map.js"></script>
<script src="game.player.js"></script>
<script src="views.js"></script>
<script src="views.html.js"></script>
<script src="views.map.js"></script>
<script src="views.map.hover.js"></script>
<script>
$(function(){
	Views.setElements({main_elem: '.game'});
	var game = new Game({views: Views});

	$(document).on('next_step', function(){
		game.NextStep();
	});
	$(document).on('click', '.start_btn', function(){
		if (!Views.isDisabled(this)){
			game.EnterPlayersCount('NewGame', true);
		}
	});
	$(document).on('click', '.step_btn', function(){
		if (!Views.isDisabled(this)){
			Views.Trigger('next_step');
		}
	});
	$(document).on('click', '.description .receipt', function(){
		game.setCurrentObjectType( Views.toggleHoverTable(this, game.getCurrentObjectType()) );
	});
	$(document).on('click', '.map .corner, .map .line', function(){
		game.setObject();
	});
	$(document).on('click', '.prompt [type="submit"]', function(e){
		var elem = $('.prompt');

		if (elem.find('[type="text"]').val()){
			e.preventDefault();
			Views.Trigger('number_entered', elem);
		}
	});
	$(document).on('click', '.prompt .cancel, .prompt .overlay', function(e){
		if (game.getCurrentPlayer())
			Views.hideModalMessage('.prompt');
	});
	$(document).on('number_entered', '.prompt[data-target="players_count"]', function(){
		if (game.setPlayersCount($(this).find('input').val()))
		{
			Views.hideModalMessage(this);
			game[$(this).data('action')]();
		}
	});
});
</script>
</head>

<body>
	<div class="game"></div>
</body>
</html>
